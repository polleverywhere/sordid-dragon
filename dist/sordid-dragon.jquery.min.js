// jQuery the Sordid Dragon
// Copyright Poll Everywhere
// Paul Cortens & Mike Foley
// https://github.com/polleverywhere/sordid-dragon
// Version 1.1.5

!function(r){return r.fn.sordidDragon=function(n){var t,e,o,i,a,d,u,s,c,l,f,g;return null==n&&(n={}),e=this,o=void 0,g=function(r){return r.css({opacity:0}),o.is(":visible")||(o.addClass("sordidDragon-placeholder"),r.after(o),o.css({opacity:.5})),r.hide(),r.css({opacity:1})},u=function(r){return o.is(":visible")?(o.after(r),o.remove(),r.show()):void 0},t=null,f=function(r){return t.is(":visible")||(t.addClass("sordidDragon-ghost"),t.css({position:"fixed",opacity:1}),e.append(t)),t.css({left:o.offset().left,top:r-o.outerHeight()/2-window.scrollY,width:o.outerWidth()-window.scrollX})},d=function(){return t.remove()},l=null,i=function(){return l=[],e.children().each(function(n,t){var e;return e=r(t),l.push([e.offset().top,e.offset().top+e.outerHeight()])}),l},a=function(r){var n,t,e;for(n=t=0,e=l.length;e>=0?e>t:t>e;n=e>=0?++t:--t)if(r>=l[n][0]&&r<l[n][1])return n;return null},c=function(r){var n,t,i;return n=e.children(":visible"),t=n.index(r),i=n.index(o),t>i?r.after(o):i>t?r.before(o):void 0},s=function(r){return/touch/.test(r.type)},e.children().each(function(l,v){var h,p;return h=r(v),p=n.handle?h.find(n.handle):h,p.attr("draggable","true"),p.on("selectstart.sordidDragon",function(r){return r.target.dragDrop()}),p.on("touchstart.sordidDragon dragstart.sordidDragon",function(r){var n;return s(r)&&(i(),t=h.clone(),r.preventDefault()),null!=(n=r.originalEvent.dataTransfer)&&n.setData("text",""),o=h.clone()}),p.on("touchmove.sordidDragon drag.sordidDragon",function(r){var n,t;return g(h),s(r)?(t=r.originalEvent.targetTouches[0].pageY,f(t),n=a(t),null!=n&&c(e.children(":visible").eq(n)),r.preventDefault()):void 0}),h.on("dragenter.sordidDragon",function(){return c(h)}),p.on("touchend.sordidDragon dragend.sordidDragon",function(r){return u(h),s(r)?(d(),i(),r.preventDefault()):void 0})})}}(jQuery);