// jQuery the Sordid Dragon
// Copyright Poll Everywhere
// Paul Cortens, Mike Foley and Adam Heath
// https://github.com/polleverywhere/sordid-dragon
// Version 2.1.0

!function(r){return r.fn.sordidDragon=function(n,o){var t,e,i,d,a,l,u,s,f,c,v,g,h,p,D;return null==n&&(n="enable"),null==o&&(o={}),"string"!=typeof n&&(o=n),i=this,c=!1,r.isFunction(i.data("removeSordidDragon"))&&i.data("removeSordidDragon")(),i.data("removeSordidDragon",function(){return c=!1,f(),s()}),d=null,t=null,D=function(r){return t=r,r.css({opacity:0}),d.is(":visible")||(d.addClass("sordidDragon-placeholder"),r.after(d),d.css({opacity:.5})),r.hide(),r.css({opacity:1})},f=function(){return(null!=d?d.is(":visible"):void 0)?(d.after(t),d.off(".sordidDragon"),d.remove(),t.show()):void 0},e=null,p=function(r){return e.is(":visible")||(e.addClass("sordidDragon-ghost"),e.css({position:"fixed",opacity:1}),i.append(e)),e.css({left:d.offset().left,top:r-d.outerHeight()/2-window.scrollY,width:d.outerWidth()-window.scrollX})},s=function(){return null!=e?e.remove():void 0},h=null,l=function(){return h=[],i.children(o.childSelector).each(function(n,o){var t;return t=r(o),h.push([t.offset().top,t.offset().top+t.outerHeight()])}),h},u=function(r){var n,o,t;for(n=o=0,t=h.length;t>=0?t>o:o>t;n=t>=0?++o:--o)if(r>=h[n][0]&&r<h[n][1])return n;return null},g=function(r){var n,t,e;return n=i.children((o.childSelector||"")+":visible"),t=n.index(r),e=n.index(d),t>e?r.after(d):e>t?r.before(d):void 0},v=function(r){return/touch/.test(r.type)},a=function(r){return r.on("dragover.sordidDragon",function(r){var n;if(c)return r.preventDefault(),null!=(n=r.originalEvent.dataTransfer)?n.dropEffect="move":void 0})},i.children(o.childSelector).each(function(t,h){var y,S;return y=r(h),S=o.handle?y.find(o.handle):y,S.attr("draggable",String("destroy"!==n)),S.off(".sordidDragon"),y.off(".sordidDragon"),"destroy"!==n?(S.on("touchstart.sordidDragon dragstart.sordidDragon",function(r){var n,t;return v(r)&&(l(),e=y.clone(),r.preventDefault()),null!=(n=r.originalEvent.dataTransfer)&&(n.effectAllowed="move"),null!=(t=r.originalEvent.dataTransfer)&&t.setData("text",""),d=y.clone(),a(d),c=!0,"function"==typeof o.sortStart?o.sortStart(r,y):void 0}),S.on("touchmove.sordidDragon drag.sordidDragon",function(r){var n,t;if(c)return D(y),v(r)?(t=r.originalEvent.targetTouches[0].pageY,p(t),n=u(t),null!=n&&g(i.children((o.childSelector||"")+":visible").eq(n)),r.preventDefault()):void 0}),y.on("dragenter.sordidDragon",function(r){return c?g(y):void 0}),a(y),S.on("touchend.sordidDragon dragend.sordidDragon",function(r){return c?(f(y),v(r)&&(s(),l(),r.preventDefault()),"function"==typeof o.sortEnd&&o.sortEnd(r,y),c=!1):void 0})):void 0})}}(jQuery);