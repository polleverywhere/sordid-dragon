// jQuery the Sordid Dragon
// Copyright Poll Everywhere
// Paul Cortens, Mike Foley and Adam Heath
// https://github.com/polleverywhere/sordid-dragon
// Version 2.0.1

!function(r){return r.fn.sordidDragon=function(n,o){var t,e,i,d,a,s,u,l,c,f,g,h,v,D;return null==n&&(n="enable"),null==o&&(o={}),"string"!=typeof n&&(o=n),i=this,c=!1,r.isFunction(i.data("removeSordidDragon"))&&i.data("removeSordidDragon")(),i.data("removeSordidDragon",function(){return c=!1,l(),u()}),d=null,t=null,D=function(r){return t=r,r.css({opacity:0}),d.is(":visible")||(d.addClass("sordidDragon-placeholder"),r.after(d),d.css({opacity:.5})),r.hide(),r.css({opacity:1})},l=function(){if(null!=d?d.is(":visible"):void 0)return d.after(t),d.remove(),t.show()},e=null,v=function(r){return e.is(":visible")||(e.addClass("sordidDragon-ghost"),e.css({position:"fixed",opacity:1}),i.append(e)),e.css({left:d.offset().left,top:r-d.outerHeight()/2-window.scrollY,width:d.outerWidth()-window.scrollX})},u=function(){return null!=e?e.remove():void 0},h=null,a=function(){return h=[],i.children(o.childSelector).each(function(n,o){var t;return t=r(o),h.push([t.offset().top,t.offset().top+t.outerHeight()])}),h},s=function(r){var n,o,t;for(n=o=0,t=h.length;0<=t?o<t:o>t;n=0<=t?++o:--o)if(r>=h[n][0]&&r<h[n][1])return n;return null},g=function(r){var n,t,e;return n=i.children((o.childSelector||"")+":visible"),t=n.index(r),e=n.index(d),t>e?r.after(d):t<e?r.before(d):void 0},f=function(r){return/touch/.test(r.type)},i.children(o.childSelector).each(function(t,h){var p,y;if(p=r(h),y=o.handle?p.find(o.handle):p,y.attr("draggable",String("destroy"!==n)),y.off("touchstart.sordidDragon dragstart.sordidDragon touchmove.sordidDragon drag.sordidDragon touchend.sordidDragon dragend.sordidDragon"),p.off("dragenter.sordidDragon"),"destroy"!==n)return y.on("touchstart.sordidDragon dragstart.sordidDragon",function(r){var n;return f(r)&&(a(),e=p.clone(),r.preventDefault()),null!=(n=r.originalEvent.dataTransfer)&&n.setData("text",""),d=p.clone(),c=!0,"function"==typeof o.sortStart?o.sortStart(r,p):void 0}),y.on("touchmove.sordidDragon drag.sordidDragon",function(r){var n,t;if(c)return D(p),f(r)?(t=r.originalEvent.targetTouches[0].pageY,v(t),n=s(t),null!=n&&g(i.children((o.childSelector||"")+":visible").eq(n)),r.preventDefault()):void 0}),p.on("dragenter.sordidDragon",function(r){if(c)return g(p)}),y.on("touchend.sordidDragon dragend.sordidDragon",function(r){if(c)return l(p),f(r)&&(u(),a(),r.preventDefault()),"function"==typeof o.sortEnd&&o.sortEnd(r,p),c=!1})})}}(jQuery);