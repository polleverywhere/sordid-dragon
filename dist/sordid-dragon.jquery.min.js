// jQuery the Sordid Dragon
// Copyright Poll Everywhere
// Paul Cortens, Mike Foley and Adam Heath
// https://github.com/polleverywhere/sordid-dragon
// Version 2.1.1

!function(r){var n;return n=function(){return"ontouchstart"in document.documentElement},r.fn.sordidDragon=function(o,t){var e,i,d,a,u,s,l,c,f,g,h,v,D,p;return null==o&&(o="enable"),null==t&&(t={}),"string"!=typeof o&&(t=o),a=this,d=r(t.ghostContainer)||a,g=!1,r.isFunction(a.data("removeSordidDragon"))&&a.data("removeSordidDragon")(),a.data("removeSordidDragon",function(){return g=!1,f(),c()}),u=null,e=null,p=function(r){return e=r,r.css({opacity:0}),u.is(":visible")||(u.addClass("sordidDragon-placeholder"),r.after(u),u.css({opacity:.5})),r.hide(),r.css({opacity:1})},f=function(){if(null!=u?u.is(":visible"):void 0)return u.after(e),u.remove(),e.show()},i=null,D=function(r){return i.is(":visible")||(i.addClass("sordidDragon-ghost").css({position:"fixed",opacity:1}),d.append(i)),i.css({left:u.offset().left,top:r-u.outerHeight()/2-window.scrollY,width:u.outerWidth()-window.scrollX})},c=function(){return null!=i?i.remove():void 0},v=null,s=function(){return v=[],a.children(t.childSelector).each(function(n,o){var t;return t=r(o),v.push([t.offset().top,t.offset().top+t.outerHeight()])}),v},l=function(r){var n,o,t;for(n=o=0,t=v.length;0<=t?o<t:o>t;n=0<=t?++o:--o)if(r>=v[n][0]&&r<v[n][1])return n;return null},h=function(r){var n,o,e;return n=a.children((t.childSelector||"")+":visible"),o=n.index(r),e=n.index(u),o>e?r.after(u):o<e?r.before(u):void 0},a.children(t.childSelector).each(function(e,d){var v,m;if(v=r(d),m=t.handle?v.find(t.handle):v,m.attr("draggable",String("destroy"!==o)),m.off("touchstart.sordidDragon dragstart.sordidDragon touchmove.sordidDragon drag.sordidDragon touchend.sordidDragon dragend.sordidDragon"),v.off("dragenter.sordidDragon"),"destroy"!==o)return m.on("touchstart.sordidDragon dragstart.sordidDragon",function(r){var o;return n()&&(s(),i=v.clone(),r.preventDefault()),null!=(o=r.originalEvent.dataTransfer)&&o.setData("text",""),u=v.clone(),g=!0}),m.on("touchmove.sordidDragon drag.sordidDragon",function(r){var o,e;if(g)return p(v),n()?(e=r.originalEvent.targetTouches[0].pageY,D(e),o=l(e),null!=o&&h(a.children((t.childSelector||"")+":visible").eq(o)),r.preventDefault()):void 0}),v.on("dragenter.sordidDragon",function(r){if(g)return h(v)}),m.on("touchend.sordidDragon dragend.sordidDragon",function(r){if(g)return f(v),n()&&(c(),s(),r.preventDefault()),"function"==typeof t.sortEnd&&t.sortEnd(r,v),g=!1})})}}(jQuery);