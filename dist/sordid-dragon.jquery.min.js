// jQuery the Sordid Dragon
// Copyright Poll Everywhere
// Paul Cortens & Mike Foley
// https://github.com/polleverywhere/sordid-dragon
// Version 1.1.2

!function(r){return r.fn.sordidDragon=function(n){var t,e,o,i,d,a,u,s,c,f,l,g;return null==n&&(n={}),e=this,o=void 0,g=function(r){return r.css({opacity:0}),o.is(":visible")||(o.addClass("sordidDragon-placeholder"),r.after(o),o.css({opacity:.5})),r.hide(),r.css({opacity:1})},u=function(r){return o.after(r),o.remove(),r.show()},t=void 0,l=function(r){return t.is(":visible")||(t.addClass("sordidDragon-ghost"),t.css({position:"fixed",opacity:1}),e.append(t)),t.css({left:o.offset().left,top:r-o.outerHeight()/2-window.scrollY,width:o.outerWidth()-window.scrollX})},a=function(){return t.remove()},f=void 0,i=function(){return f=[],e.children().each(function(n,t){var e;return e=r(t),f.push([e.offset().top,e.offset().top+e.outerHeight()])}),f},d=function(r){var n,t,e;for(n=t=0,e=f.length;e>=0?e>=t:t>=e;n=e>=0?++t:--t)if(r>=f[n][0]&&r<f[n][1])return n},c=function(r){var n,t,i;return n=e.children(":visible"),t=n.index(r),i=n.index(o),t>i?r.after(o):i>t?r.before(o):void 0},s=function(r){return/touch/.test(r.type)},e.children().each(function(f,h){var v,p;return v=r(h),p=n.handle?v.find(n.handle):v,p.attr("draggable","true"),p.on("selectstart",function(){return"function"==typeof this.dragDrop&&this.dragDrop(),!1}),p.on("touchstart.sordidDragon dragstart.sordidDragon",function(r){var n;return s(r)&&(i(),t=v.clone(),r.preventDefault()),null!=(n=r.originalEvent.dataTransfer)&&n.setData("text",""),o=v.clone()}),p.on("touchmove.sordidDragon drag.sordidDragon",function(r){var n,t;return g(v),s(r)?(t=r.originalEvent.targetTouches[0].pageY,l(t),n=d(t),"undefined"!=typeof n&&c(e.children(":visible").eq(n)),r.preventDefault()):void 0}),v.on("dragenter.sordidDragon",function(){return c(v)}),p.on("touchend.sordidDragon dragend.sordidDragon",function(r){return u(v),s(r)?(a(),i(),r.preventDefault()):void 0})})}}(jQuery);