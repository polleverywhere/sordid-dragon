// jQuery the Sordid Dragon
// Copyright Poll Everywhere
// Paul Cortens & Mike Foley
// https://github.com/polleverywhere/sordid-dragon
// Version 1.3.1

!function(r){return r.fn.sordidDragon=function(n,o){var t,e,d,i,a,s,u,l,c,f,g,h,v,D;return null==n&&(n="enable"),null==o&&(o={}),"string"!=typeof n&&(o=n),d=this,c=!1,r.isFunction(d.data("removeSordidDragon"))&&d.data("removeSordidDragon")(),d.data("removeSordidDragon",function(){return c=!1,l(),u()}),i=null,t=null,D=function(r){return t=r,r.css({opacity:0}),i.is(":visible")||(i.addClass("sordidDragon-placeholder"),r.after(i),i.css({opacity:.5})),r.hide(),r.css({opacity:1})},l=function(){return i&&i.is(":visible")?(i.after(t),i.remove(),t.show()):void 0},e=null,v=function(r){return e.is(":visible")||(e.addClass("sordidDragon-ghost"),e.css({position:"fixed",opacity:1}),d.append(e)),e.css({left:i.offset().left,top:r-i.outerHeight()/2-window.scrollY,width:i.outerWidth()-window.scrollX})},u=function(){return e?e.remove():void 0},h=null,a=function(){return h=[],d.children(o.childSelector).each(function(n,o){var t;return t=r(o),h.push([t.offset().top,t.offset().top+t.outerHeight()])}),h},s=function(r){var n,o,t;for(n=o=0,t=h.length;t>=0?t>o:o>t;n=t>=0?++o:--o)if(r>=h[n][0]&&r<h[n][1])return n;return null},g=function(r){var n,t,e;return n=d.children((o.childSelector||"")+":visible"),t=n.index(r),e=n.index(i),t>e?r.after(i):e>t?r.before(i):void 0},f=function(r){return/touch/.test(r.type)},d.children(o.childSelector).each(function(t,h){var p,y;return p=r(h),y=o.handle?p.find(o.handle):p,y.attr("draggable",String("destroy"!==n)),y.off("touchstart.sordidDragon dragstart.sordidDragon touchmove.sordidDragon drag.sordidDragon touchend.sordidDragon dragend.sordidDragon"),p.off("dragenter.sordidDragon"),"destroy"!==n?(y.on("touchstart.sordidDragon dragstart.sordidDragon",function(r){var n;return f(r)&&(a(),e=p.clone(),r.preventDefault()),null!=(n=r.originalEvent.dataTransfer)&&n.setData("text",""),i=p.clone(),c=!0}),y.on("touchmove.sordidDragon drag.sordidDragon",function(r){var n,t;return c&&(D(p),f(r))?(t=r.originalEvent.targetTouches[0].pageY,v(t),n=s(t),null!=n&&g(d.children((o.childSelector||"")+":visible").eq(n)),r.preventDefault()):void 0}),p.on("dragenter.sordidDragon",function(r){return c?g(p):void 0}),y.on("touchend.sordidDragon dragend.sordidDragon",function(r){return c&&(l(p),f(r)&&(u(),a(),r.preventDefault()),"function"==typeof o.sortEnd&&o.sortEnd(r,p)),c=!1})):void 0})}}(jQuery);