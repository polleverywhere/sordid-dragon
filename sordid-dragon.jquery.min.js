// jQuery the Sordid Dragon
// Copyright Poll Everywhere
// Paul Cortens & Mike Foley
// https://github.com/polleverywhere/sordid-dragon
// Version 1.0.0

!function(r){return r.fn.sordidDragon=function(){var t,n,e,o,i,a,d,u,s,c,f,l;return n=this,e=void 0,l=function(r){return r.css({opacity:0}),e.is(":visible")||(e.addClass("sordidDragon-placeholder"),r.after(e),e.css({opacity:.5})),r.hide(),r.css({opacity:1})},d=function(r){return e.after(r),e.remove(),r.show()},t=void 0,f=function(r){return t.is(":visible")||(t.addClass("sordidDragon-ghost"),t.css({position:"fixed",opacity:1}),n.append(t)),t.css({left:e.offset().left,top:r-e.outerHeight()/2-window.scrollY,width:e.outerWidth()-window.scrollX})},a=function(){return t.remove()},c=void 0,o=function(){return c=[],n.children().each(function(t,n){var e;return e=r(n),c.push([e.offset().top,e.offset().top+e.outerHeight()])}),c},i=function(r){var t,n,e;for(t=n=0,e=c.length;e>=0?e>=n:n>=e;t=e>=0?++n:--n)if(r>=c[t][0]&&r<c[t][1])return t},s=function(r){var t,o,i;return t=n.children(":visible"),o=t.index(r),i=t.index(e),o>i?r.after(e):i>o?r.before(e):void 0},u=function(r){return/touch/.test(r.type)},n.children().each(function(c,g){var v;return v=r(g),v.attr("draggable","true"),v.on("selectstart",function(){return"function"==typeof this.dragDrop&&this.dragDrop(),!1}),v.on("touchstart.sordidDragon dragstart.sordidDragon",function(r){var n;return u(r)&&(o(),t=v.clone(),r.preventDefault()),n=r.originalEvent.dataTransfer,null!=n&&n.setData("text",""),e=v.clone()}),v.on("touchmove.sordidDragon drag.sordidDragon",function(r){var t,e;return l(v),u(r)?(e=r.originalEvent.targetTouches[0].pageY,f(e),t=i(e),"undefined"!=typeof t&&s(n.children(":visible").eq(t)),r.preventDefault()):void 0}),v.on("dragenter.sordidDragon",function(){return s(v)}),v.on("touchend.sordidDragon dragend.sordidDragon",function(r){return d(v),u(r)?(a(),o(),r.preventDefault()):void 0})})}}(jQuery);